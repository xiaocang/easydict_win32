<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Easydict.WinUI.Views.FixedWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Easydict.WinUI.Views.Controls"
    mc:Ignorable="d"
    Title="Easydict Fixed">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Padding="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header with Close button (no Pin - always on top) - also serves as drag region -->
        <Grid x:Name="TitleBarRegion" Grid.Row="0" Margin="0,0,0,4" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock
                Grid.Column="0"
                Text="Fixed Translate"
                FontSize="12"
                FontWeight="SemiBold"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                VerticalAlignment="Center"
                Margin="4,0,0,0" />

            <Button
                x:Name="CloseButton"
                Grid.Column="1"
                Click="OnCloseClicked"
                ToolTipService.ToolTip="Hide (Ctrl+Alt+F to show again)"
                Background="Transparent"
                BorderThickness="0"
                Width="28"
                Height="28"
                Padding="0">
                <FontIcon Glyph="&#xE8BB;" FontSize="14" />
            </Button>
        </Grid>

        <!-- Compact Input -->
        <Border Grid.Row="1"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="6"
                Padding="8"
                Margin="0,0,0,4">
            <TextBox
                x:Name="InputTextBox"
                PlaceholderText="Enter text..."
                BorderThickness="0"
                Background="Transparent"
                MinHeight="40"
                MaxHeight="120"
                AcceptsReturn="True"
                TextWrapping="Wrap"
                ScrollViewer.VerticalScrollBarVisibility="Auto"
                PreviewKeyDown="OnInputKeyDown" />
        </Border>

        <!-- Language Bar -->
        <Grid Grid.Row="2" Margin="0,0,0,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <ComboBox
                x:Name="SourceLangCombo"
                Grid.Column="0"
                HorizontalAlignment="Stretch"
                SelectedIndex="0"
                ToolTipService.ToolTip="Source Language">
                <ComboBoxItem Content="Auto" Tag="auto" />
                <ComboBoxItem Content="English" Tag="en" />
                <ComboBoxItem Content="Chinese" Tag="zh" />
                <ComboBoxItem Content="Japanese" Tag="ja" />
            </ComboBox>

            <Button
                x:Name="SwapButton"
                Grid.Column="1"
                Click="OnSwapClicked"
                Width="28" Height="28"
                Padding="0"
                Background="Transparent"
                BorderThickness="0"
                ToolTipService.ToolTip="Swap languages"
                Margin="4,0">
                <FontIcon Glyph="&#xE8AB;" FontSize="12" />
            </Button>

            <ComboBox
                x:Name="TargetLangCombo"
                Grid.Column="2"
                HorizontalAlignment="Stretch"
                SelectedIndex="1"
                SelectionChanged="OnTargetLangChanged"
                ToolTipService.ToolTip="Target Language">
                <ComboBoxItem Content="English" Tag="en" />
                <ComboBoxItem Content="Chinese" Tag="zh" />
                <ComboBoxItem Content="Japanese" Tag="ja" />
                <ComboBoxItem Content="Korean" Tag="ko" />
                <ComboBoxItem Content="French" Tag="fr" />
                <ComboBoxItem Content="German" Tag="de" />
                <ComboBoxItem Content="Spanish" Tag="es" />
            </ComboBox>

            <Button
                x:Name="TranslateButton"
                Grid.Column="3"
                Click="OnTranslateClicked"
                Width="32"
                Height="32"
                Padding="0"
                CornerRadius="16"
                Background="{StaticResource AccentBrush}"
                ToolTipService.ToolTip="Translate"
                Margin="4,0,0,0">
                <Grid>
                    <ProgressRing
                        x:Name="LoadingRing"
                        IsActive="False"
                        Width="14" Height="14"
                        Foreground="White"
                        Visibility="Collapsed" />
                    <FontIcon
                        x:Name="TranslateIcon"
                        Glyph="&#xE8C1;"
                        FontSize="14"
                        Foreground="White" />
                </Grid>
            </Button>
        </Grid>

        <!-- Detected Language Label -->
        <TextBlock
            x:Name="DetectedLangText"
            Grid.Row="3"
            Text=""
            FontSize="10"
            Foreground="{ThemeResource AccentBrush}"
            Margin="0,0,0,2"
            Visibility="Collapsed" />

        <!-- Multi-Service Results -->
        <ScrollViewer
            Grid.Row="4"
            VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="ResultsPanel">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <TextBlock
            x:Name="StatusText"
            Grid.Row="5"
            Text=""
            FontSize="10"
            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
            HorizontalAlignment="Right"
            Margin="0,4,0,0" />
    </Grid>
</Window>
