<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Easydict.WinUI.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <ScrollViewer Padding="24">
            <StackPanel Spacing="24" MaxWidth="800">
            <!-- Header -->
            <Grid>
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Click="OnBackClick" Style="{StaticResource AccentButtonStyle}" Padding="8">
                        <FontIcon Glyph="&#xE72B;" FontSize="16" />
                    </Button>
                    <TextBlock Text="Settings" FontSize="28" FontWeight="SemiBold" VerticalAlignment="Center" />
                </StackPanel>
            </Grid>

            <!-- Translation Service -->
            <StackPanel Spacing="12">
                <TextBlock Text="Translation Service" FontSize="18" FontWeight="SemiBold" />
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <ComboBox x:Name="ServiceCombo" Header="Default Service" Width="200">
                            <ComboBoxItem Content="Google Translate" Tag="google" />
                            <ComboBoxItem Content="DeepL" Tag="deepl" />
                            <ComboBoxItem Content="OpenAI" Tag="openai" />
                            <ComboBoxItem Content="Ollama" Tag="ollama" />
                            <ComboBoxItem Content="Built-in AI" Tag="builtin" />
                        </ComboBox>

                        <ComboBox x:Name="TargetLangCombo" Header="Target Language" Width="200">
                            <ComboBoxItem Content="Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="English" Tag="en" />
                            <ComboBoxItem Content="Japanese" Tag="ja" />
                            <ComboBoxItem Content="Korean" Tag="ko" />
                            <ComboBoxItem Content="French" Tag="fr" />
                            <ComboBoxItem Content="German" Tag="de" />
                            <ComboBoxItem Content="Spanish" Tag="es" />
                        </ComboBox>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Language Preferences -->
            <StackPanel Spacing="12">
                <TextBlock Text="Language Preferences" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <!-- First Language -->
                        <ComboBox
                            x:Name="FirstLanguageCombo"
                            Header="First Language"
                            Width="250"
                            HorizontalAlignment="Left">
                            <ComboBoxItem Content="ðŸ‡¨ðŸ‡³ Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="ðŸ‡ºðŸ‡¸ English" Tag="en" />
                            <ComboBoxItem Content="ðŸ‡¯ðŸ‡µ Japanese" Tag="ja" />
                            <ComboBoxItem Content="ðŸ‡°ðŸ‡· Korean" Tag="ko" />
                            <ComboBoxItem Content="ðŸ‡«ðŸ‡· French" Tag="fr" />
                            <ComboBoxItem Content="ðŸ‡©ðŸ‡ª German" Tag="de" />
                            <ComboBoxItem Content="ðŸ‡ªðŸ‡¸ Spanish" Tag="es" />
                        </ComboBox>

                        <!-- Second Language -->
                        <ComboBox
                            x:Name="SecondLanguageCombo"
                            Header="Second Language"
                            Width="250"
                            HorizontalAlignment="Left">
                            <ComboBoxItem Content="ðŸ‡ºðŸ‡¸ English" Tag="en" />
                            <ComboBoxItem Content="ðŸ‡¨ðŸ‡³ Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="ðŸ‡¯ðŸ‡µ Japanese" Tag="ja" />
                            <ComboBoxItem Content="ðŸ‡°ðŸ‡· Korean" Tag="ko" />
                            <ComboBoxItem Content="ðŸ‡«ðŸ‡· French" Tag="fr" />
                            <ComboBoxItem Content="ðŸ‡©ðŸ‡ª German" Tag="de" />
                            <ComboBoxItem Content="ðŸ‡ªðŸ‡¸ Spanish" Tag="es" />
                        </ComboBox>

                        <!-- Explanation -->
                        <TextBlock
                            TextWrapping="Wrap"
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Margin="0,4,0,0">
                            <Run Text="When detected language matches your First Language, translation target will be your Second Language, and vice versa." />
                        </TextBlock>

                        <!-- Auto-Select Toggle -->
                        <ToggleSwitch
                            x:Name="AutoSelectTargetToggle"
                            Header="Automatically select target language based on detected source"
                            IsOn="True" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- API Keys -->
            <StackPanel Spacing="12">
                <TextBlock Text="API Keys" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <PasswordBox x:Name="DeepLKeyBox" Header="DeepL API Key" Width="300" PlaceholderText="Enter your DeepL API key" />
                        <CheckBox x:Name="DeepLFreeCheck" Content="Use DeepL Free API" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- AI Translation Services -->
            <StackPanel Spacing="12">
                <TextBlock Text="AI Translation Services" FontSize="18" FontWeight="SemiBold" />

                <!-- OpenAI -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBlock Text="OpenAI" FontWeight="SemiBold" FontSize="14" />
                        <PasswordBox x:Name="OpenAIKeyBox" Header="API Key" Width="300" PlaceholderText="sk-..." />
                        <TextBox x:Name="OpenAIEndpointBox" Header="Endpoint (optional)" Width="400"
                                 PlaceholderText="https://api.openai.com/v1/chat/completions" />
                        <ComboBox x:Name="OpenAIModelCombo" Header="Model" Width="200">
                            <ComboBoxItem Content="gpt-4o-mini" Tag="gpt-4o-mini" />
                            <ComboBoxItem Content="gpt-4o" Tag="gpt-4o" />
                            <ComboBoxItem Content="gpt-4-turbo" Tag="gpt-4-turbo" />
                            <ComboBoxItem Content="gpt-3.5-turbo" Tag="gpt-3.5-turbo" />
                        </ComboBox>
                    </StackPanel>
                </Border>

                <!-- Ollama (Local) -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Ollama (Local LLM)" FontWeight="SemiBold" FontSize="14" />
                        <TextBox x:Name="OllamaEndpointBox" Header="Endpoint" Width="400"
                                 PlaceholderText="http://localhost:11434/v1/chat/completions" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <ComboBox x:Name="OllamaModelCombo" Header="Model" Width="200" IsEditable="True" />
                            <Button x:Name="RefreshOllamaButton" Content="Refresh" Click="OnRefreshOllamaModels"
                                    VerticalAlignment="Bottom" Padding="12,6" />
                        </StackPanel>
                        <TextBlock Text="Ollama must be running locally. Click Refresh to load available models."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Border>

                <!-- Built-in AI -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Built-in AI" FontWeight="SemiBold" FontSize="14" />
                        <ComboBox x:Name="BuiltInModelCombo" Header="Model" Width="250">
                            <ComboBoxItem Content="llama-3.3-70b-versatile" Tag="llama-3.3-70b-versatile" />
                            <ComboBoxItem Content="llama-3.1-8b-instant" Tag="llama-3.1-8b-instant" />
                        </ComboBox>
                        <TextBlock Text="Built-in AI uses Groq cloud service. No API key required."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- HTTP Proxy -->
            <StackPanel Spacing="12">
                <TextBlock Text="HTTP Proxy" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <ToggleSwitch x:Name="ProxyEnabledToggle" Header="Use HTTP Proxy" />
                        <TextBox x:Name="ProxyUriBox" Header="Proxy URL" Width="300"
                                 PlaceholderText="http://127.0.0.1:7890" />
                        <ToggleSwitch x:Name="ProxyBypassLocalToggle" Header="Bypass proxy for localhost" IsOn="True" />
                        <TextBlock Text="Proxy changes take effect after app restart. Localhost bypass ensures Ollama works without proxy."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Behavior -->
            <StackPanel Spacing="12">
                <TextBlock Text="Behavior" FontSize="18" FontWeight="SemiBold" />
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <ToggleSwitch x:Name="MinimizeToTrayToggle" Header="Minimize to system tray" />
                        <ToggleSwitch x:Name="ClipboardMonitorToggle" Header="Monitor clipboard for text" />
                        <ToggleSwitch x:Name="AlwaysOnTopToggle" Header="Always on top" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Hotkeys -->
            <StackPanel Spacing="12">
                <TextBlock Text="Hotkeys" FontSize="18" FontWeight="SemiBold" />
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBox x:Name="ShowHotkeyBox" Header="Show Window" Width="200" PlaceholderText="Ctrl+Alt+T" />
                        <TextBox x:Name="TranslateHotkeyBox" Header="Translate Selection" Width="200" PlaceholderText="Ctrl+Alt+D" />
                        <TextBlock Text="Note: Restart app to apply hotkey changes" 
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- About -->
            <StackPanel Spacing="12">
                <TextBlock Text="About" FontSize="18" FontWeight="SemiBold" />
                
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Easydict for Windows" FontWeight="SemiBold" />
                        <TextBlock Text="Version 1.0.0" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <HyperlinkButton Content="GitHub Repository" NavigateUri="https://github.com/tisfeng/Easydict" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Spacer to make room for floating save button -->
            <Border Height="80" />
        </StackPanel>
    </ScrollViewer>

    <!-- Floating Save Button (fixed at bottom-right) -->
    <Button x:Name="SaveButton"
            Content="Save Settings"
            Click="OnSaveClick"
            Style="{StaticResource AccentButtonStyle}"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,32,32"
            Padding="24,12"
            Visibility="Collapsed">
        <Button.Shadow>
            <ThemeShadow />
        </Button.Shadow>
    </Button>
</Grid>
</Page>

