<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Easydict.WinUI.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:Easydict.WinUI.Views"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <ScrollViewer x:Name="MainScrollViewer" Padding="24" ViewChanged="OnScrollViewChanged">
            <StackPanel Spacing="24" MaxWidth="800">
            <!-- Header -->
            <Grid x:Name="HeaderSection">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <Button Click="OnBackClick" Style="{StaticResource AccentButtonStyle}" Padding="8">
                        <FontIcon Glyph="&#xE72B;" FontSize="16" />
                    </Button>
                    <TextBlock Text="Settings" FontSize="28" FontWeight="SemiBold" VerticalAlignment="Center" />
                </StackPanel>
            </Grid>

            <!-- Translation Service -->
            <StackPanel x:Name="TranslationServiceSection" Spacing="12">
                <TextBlock Text="Translation Service" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <ComboBox x:Name="ServiceCombo" Header="Default Service" Width="250">
                            <ComboBoxItem Content="Google Translate" Tag="google" />
                            <ComboBoxItem Content="DeepL" Tag="deepl" />
                            <ComboBoxItem Content="OpenAI" Tag="openai" />
                            <ComboBoxItem Content="Ollama (Local)" Tag="ollama" />
                            <ComboBoxItem Content="Built-in AI" Tag="builtin" />
                            <ComboBoxItem Content="DeepSeek" Tag="deepseek" />
                            <ComboBoxItem Content="Groq" Tag="groq" />
                            <ComboBoxItem Content="Zhipu (æ™ºè°±)" Tag="zhipu" />
                            <ComboBoxItem Content="GitHub Models" Tag="github" />
                            <ComboBoxItem Content="Gemini" Tag="gemini" />
                            <ComboBoxItem Content="Custom OpenAI" Tag="custom-openai" />
                            <ComboBoxItem Content="Doubao (è±†åŒ…)" Tag="doubao" />
                            <ComboBoxItem Content="Caiyun (å½©äº‘)" Tag="caiyun" />
                            <ComboBoxItem Content="NiuTrans (å°ç‰›)" Tag="niutrans" />
                            <ComboBoxItem Content="Linguee Dictionary" Tag="linguee" />
                        </ComboBox>

                        <ComboBox x:Name="TargetLangCombo" Header="Target Language" Width="200">
                            <ComboBoxItem Content="Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="English" Tag="en" />
                            <ComboBoxItem Content="Japanese" Tag="ja" />
                            <ComboBoxItem Content="Korean" Tag="ko" />
                            <ComboBoxItem Content="French" Tag="fr" />
                            <ComboBoxItem Content="German" Tag="de" />
                            <ComboBoxItem Content="Spanish" Tag="es" />
                        </ComboBox>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Enabled Services for Each Window -->
            <StackPanel x:Name="EnabledServicesSection" Spacing="12">
                <TextBlock Text="Enabled Services" FontSize="18" FontWeight="SemiBold" />
                <TextBlock Text="Select which translation services to display in each window. Multiple services will run in parallel."
                           FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />

                <!-- Main Window Services -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Main Window" FontWeight="SemiBold" FontSize="14" />
                        <ItemsControl x:Name="MainWindowServicesPanel">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <CheckBox
                                            Content="{Binding DisplayName}"
                                            Tag="{Binding ServiceId}"
                                            IsChecked="{Binding IsChecked, Mode=TwoWay}" />
                                        <ToggleSwitch
                                            Grid.Column="1"
                                            IsOn="{Binding EnabledQuery, Mode=TwoWay}"
                                            OnContent="Auto"
                                            OffContent="Manual"
                                            Visibility="{Binding IsChecked, Converter={StaticResource BoolToVisibilityConverter}}"
                                            MinWidth="0"
                                            Margin="8,0,0,0" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Mini Window Services -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Mini Window" FontWeight="SemiBold" FontSize="14" />
                        <ItemsControl x:Name="MiniWindowServicesPanel">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <CheckBox
                                            Content="{Binding DisplayName}"
                                            Tag="{Binding ServiceId}"
                                            IsChecked="{Binding IsChecked, Mode=TwoWay}" />
                                        <ToggleSwitch
                                            Grid.Column="1"
                                            IsOn="{Binding EnabledQuery, Mode=TwoWay}"
                                            OnContent="Auto"
                                            OffContent="Manual"
                                            Visibility="{Binding IsChecked, Converter={StaticResource BoolToVisibilityConverter}}"
                                            MinWidth="0"
                                            Margin="8,0,0,0" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Fixed Window Services -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Fixed Window" FontWeight="SemiBold" FontSize="14" />
                        <ItemsControl x:Name="FixedWindowServicesPanel">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <CheckBox
                                            Content="{Binding DisplayName}"
                                            Tag="{Binding ServiceId}"
                                            IsChecked="{Binding IsChecked, Mode=TwoWay}" />
                                        <ToggleSwitch
                                            Grid.Column="1"
                                            IsOn="{Binding EnabledQuery, Mode=TwoWay}"
                                            OnContent="Auto"
                                            OffContent="Manual"
                                            Visibility="{Binding IsChecked, Converter={StaticResource BoolToVisibilityConverter}}"
                                            MinWidth="0"
                                            Margin="8,0,0,0" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Language Preferences -->
            <StackPanel x:Name="LanguagePreferencesSection" Spacing="12">
                <TextBlock Text="Language Preferences" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <!-- First Language -->
                        <ComboBox
                            x:Name="FirstLanguageCombo"
                            Header="First Language"
                            Width="250"
                            HorizontalAlignment="Left">
                            <ComboBoxItem Content="ðŸ‡¨ðŸ‡³ Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="ðŸ‡ºðŸ‡¸ English" Tag="en" />
                            <ComboBoxItem Content="ðŸ‡¯ðŸ‡µ Japanese" Tag="ja" />
                            <ComboBoxItem Content="ðŸ‡°ðŸ‡· Korean" Tag="ko" />
                            <ComboBoxItem Content="ðŸ‡«ðŸ‡· French" Tag="fr" />
                            <ComboBoxItem Content="ðŸ‡©ðŸ‡ª German" Tag="de" />
                            <ComboBoxItem Content="ðŸ‡ªðŸ‡¸ Spanish" Tag="es" />
                        </ComboBox>

                        <!-- Second Language -->
                        <ComboBox
                            x:Name="SecondLanguageCombo"
                            Header="Second Language"
                            Width="250"
                            HorizontalAlignment="Left">
                            <ComboBoxItem Content="ðŸ‡ºðŸ‡¸ English" Tag="en" />
                            <ComboBoxItem Content="ðŸ‡¨ðŸ‡³ Chinese (Simplified)" Tag="zh" />
                            <ComboBoxItem Content="ðŸ‡¯ðŸ‡µ Japanese" Tag="ja" />
                            <ComboBoxItem Content="ðŸ‡°ðŸ‡· Korean" Tag="ko" />
                            <ComboBoxItem Content="ðŸ‡«ðŸ‡· French" Tag="fr" />
                            <ComboBoxItem Content="ðŸ‡©ðŸ‡ª German" Tag="de" />
                            <ComboBoxItem Content="ðŸ‡ªðŸ‡¸ Spanish" Tag="es" />
                        </ComboBox>

                        <!-- Explanation -->
                        <TextBlock
                            TextWrapping="Wrap"
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Margin="0,4,0,0">
                            <Run Text="When detected language matches your First Language, translation target will be your Second Language, and vice versa." />
                        </TextBlock>

                        <!-- Auto-Select Toggle -->
                        <ToggleSwitch
                            x:Name="AutoSelectTargetToggle"
                            Header="Automatically select target language based on detected source"
                            IsOn="True" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Service Configuration -->
            <StackPanel x:Name="ServiceConfigurationSection" Spacing="12">
                <TextBlock Text="Service Configuration" FontSize="18" FontWeight="SemiBold" />
                <TextBlock Text="Configure API keys, endpoints, and models for each translation service."
                           FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                <!-- DeepL -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="DeepL" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="DeepLKeyBox" Header="API Key (Optional)" Width="350" PlaceholderText="Enter your DeepL API key" HorizontalAlignment="Left" />
                        <CheckBox x:Name="DeepLFreeCheck" Content="Use Free API (no API key required for web translation)" />
                        <TextBlock Text="Leave API key empty to use free web translation. Pro API key gives higher limits."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- OpenAI -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="OpenAI" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="OpenAIKeyBox" Header="API Key" Width="350" PlaceholderText="sk-..." HorizontalAlignment="Left" />
                        <TextBox x:Name="OpenAIEndpointBox" Header="Endpoint (Optional)" Width="450"
                                 PlaceholderText="https://api.openai.com/v1/chat/completions" HorizontalAlignment="Left" />
                        <ComboBox x:Name="OpenAIModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="gpt-4o-mini" Tag="gpt-4o-mini" />
                            <ComboBoxItem Content="gpt-4o" Tag="gpt-4o" />
                            <ComboBoxItem Content="gpt-4-turbo" Tag="gpt-4-turbo" />
                            <ComboBoxItem Content="gpt-3.5-turbo" Tag="gpt-3.5-turbo" />
                        </ComboBox>
                        <TextBlock Text="You can type a custom model name directly."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Expander>

                <!-- DeepSeek -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="DeepSeek" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="DeepSeekKeyBox" Header="API Key" Width="350" PlaceholderText="sk-..." HorizontalAlignment="Left" />
                        <ComboBox x:Name="DeepSeekModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="deepseek-chat" Tag="deepseek-chat" />
                            <ComboBoxItem Content="deepseek-reasoner" Tag="deepseek-reasoner" />
                        </ComboBox>
                        <TextBlock Text="Get your API key from platform.deepseek.com. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Groq -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Groq" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="GroqKeyBox" Header="API Key" Width="350" PlaceholderText="gsk_..." HorizontalAlignment="Left" />
                        <ComboBox x:Name="GroqModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="llama-3.3-70b-versatile" Tag="llama-3.3-70b-versatile" />
                            <ComboBoxItem Content="llama-3.1-8b-instant" Tag="llama-3.1-8b-instant" />
                            <ComboBoxItem Content="gemma2-9b-it" Tag="gemma2-9b-it" />
                            <ComboBoxItem Content="mixtral-8x7b-32768" Tag="mixtral-8x7b-32768" />
                        </ComboBox>
                        <TextBlock Text="Groq provides fast inference. Get your API key from console.groq.com. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Zhipu (æ™ºè°±) -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Zhipu (æ™ºè°±)" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="ZhipuKeyBox" Header="API Key" Width="350" PlaceholderText="Enter your Zhipu API key" HorizontalAlignment="Left" />
                        <ComboBox x:Name="ZhipuModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="glm-4-flash-250414" Tag="glm-4-flash-250414" />
                            <ComboBoxItem Content="glm-4.5-flash" Tag="glm-4.5-flash" />
                            <ComboBoxItem Content="glm-4.7" Tag="glm-4.7" />
                            <ComboBoxItem Content="glm-4.5-air" Tag="glm-4.5-air" />
                        </ComboBox>
                        <TextBlock Text="Get your API key from open.bigmodel.cn. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- GitHub Models -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="GitHub Models" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="GitHubModelsTokenBox" Header="GitHub Token" Width="350" PlaceholderText="ghp_..." HorizontalAlignment="Left" />
                        <ComboBox x:Name="GitHubModelsModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="gpt-4.1" Tag="gpt-4.1" />
                            <ComboBoxItem Content="gpt-4.1-mini" Tag="gpt-4.1-mini" />
                            <ComboBoxItem Content="gpt-4.1-nano" Tag="gpt-4.1-nano" />
                            <ComboBoxItem Content="gpt-4o" Tag="gpt-4o" />
                            <ComboBoxItem Content="gpt-4o-mini" Tag="gpt-4o-mini" />
                            <ComboBoxItem Content="deepseek-v3-0324" Tag="deepseek-v3-0324" />
                        </ComboBox>
                        <TextBlock Text="Use your GitHub personal access token. Get one from github.com/settings/tokens. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Gemini -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Gemini" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="GeminiKeyBox" Header="API Key" Width="350" PlaceholderText="Enter your Gemini API key" HorizontalAlignment="Left" />
                        <ComboBox x:Name="GeminiModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="gemini-2.5-flash" Tag="gemini-2.5-flash" />
                            <ComboBoxItem Content="gemini-2.5-flash-lite" Tag="gemini-2.5-flash-lite" />
                            <ComboBoxItem Content="gemini-2.5-pro" Tag="gemini-2.5-pro" />
                            <ComboBoxItem Content="gemini-2.0-flash" Tag="gemini-2.0-flash" />
                            <ComboBoxItem Content="gemini-1.5-flash" Tag="gemini-1.5-flash" />
                            <ComboBoxItem Content="gemini-1.5-pro" Tag="gemini-1.5-pro" />
                            <ComboBoxItem Content="gemini-3-flash-preview" Tag="gemini-3-flash-preview" />
                            <ComboBoxItem Content="gemini-3-pro-preview" Tag="gemini-3-pro-preview" />
                        </ComboBox>
                        <TextBlock Text="Get your API key from aistudio.google.com. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Custom OpenAI Compatible -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Custom OpenAI Compatible" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <TextBox x:Name="CustomOpenAIEndpointBox" Header="Endpoint (Required)" Width="450"
                                 PlaceholderText="https://your-api.example.com/v1/chat/completions" HorizontalAlignment="Left" />
                        <PasswordBox x:Name="CustomOpenAIKeyBox" Header="API Key (Optional)" Width="350" PlaceholderText="Enter API key if required" HorizontalAlignment="Left" />
                        <TextBox x:Name="CustomOpenAIModelBox" Header="Model" Width="200"
                                 PlaceholderText="gpt-3.5-turbo" HorizontalAlignment="Left" />
                        <TextBlock Text="Configure any OpenAI-compatible API endpoint (e.g., local LLM servers, other AI providers)."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Ollama (Local) -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Ollama (Local LLM)" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <TextBox x:Name="OllamaEndpointBox" Header="Endpoint" Width="450"
                                 PlaceholderText="http://localhost:11434/v1/chat/completions" HorizontalAlignment="Left" />
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <ComboBox x:Name="OllamaModelCombo" Header="Model" Width="200" IsEditable="True" />
                            <Button x:Name="RefreshOllamaButton" Content="Refresh" Click="OnRefreshOllamaModels"
                                    VerticalAlignment="Bottom" Padding="12,6" />
                        </StackPanel>
                        <TextBlock Text="Ollama must be running locally. Click Refresh to load available models."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Expander>

                <!-- Built-in AI -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Built-in AI" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <ComboBox x:Name="BuiltInModelCombo" Header="Model" Width="280" IsEditable="True">
                            <ComboBoxItem Content="llama-3.3-70b-versatile" Tag="llama-3.3-70b-versatile" />
                            <ComboBoxItem Content="llama-3.1-8b-instant" Tag="llama-3.1-8b-instant" />
                            <ComboBoxItem Content="gemma2-9b-it" Tag="gemma2-9b-it" />
                            <ComboBoxItem Content="mixtral-8x7b-32768" Tag="mixtral-8x7b-32768" />
                        </ComboBox>
                        <TextBlock Text="Built-in AI uses Groq cloud service. No API key required. You can type a custom model name."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Doubao (è±†åŒ…) -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Doubao (è±†åŒ…)" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="DoubaoKeyBox" Header="API Key" Width="350" PlaceholderText="Enter your Doubao API key" HorizontalAlignment="Left" />
                        <TextBox x:Name="DoubaoEndpointBox" Header="Endpoint" Width="450"
                                 PlaceholderText="https://ark.cn-beijing.volces.com/api/v3/responses" HorizontalAlignment="Left" />
                        <TextBox x:Name="DoubaoModelBox" Header="Model" Width="300"
                                 PlaceholderText="doubao-seed-translation-250915" HorizontalAlignment="Left" />
                        <TextBlock Text="ByteDance's Doubao translation service. Get your API key from console.volcengine.com"
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Caiyun (å½©äº‘å°è¯‘) -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="Caiyun (å½©äº‘å°è¯‘)" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="CaiyunKeyBox" Header="API Key" Width="350" PlaceholderText="Enter your Caiyun API key" HorizontalAlignment="Left" />
                        <TextBlock Text="Get your API key from fanyi.caiyunapp.com"
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Expander>

                <!-- NiuTrans (å°ç‰›ç¿»è¯‘) -->
                <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                    <Expander.Header>
                        <TextBlock Text="NiuTrans (å°ç‰›ç¿»è¯‘)" FontWeight="SemiBold" />
                    </Expander.Header>
                    <StackPanel Spacing="12" Padding="0,8">
                        <PasswordBox x:Name="NiuTransKeyBox" Header="API Key" Width="350" PlaceholderText="Enter your NiuTrans API key" HorizontalAlignment="Left" />
                        <TextBlock Text="NiuTrans supports 450+ language pairs. Get your API key from niutrans.com"
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Expander>

                <!-- Google Translate & Linguee (No configuration needed) -->
                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Free Services (No Configuration Required)" FontWeight="SemiBold" />
                        <TextBlock Text="Google Translate and Linguee Dictionary work out of the box without API keys."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- HTTP Proxy -->
            <StackPanel x:Name="HttpProxySection" Spacing="12">
                <TextBlock Text="HTTP Proxy" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <ToggleSwitch x:Name="ProxyEnabledToggle" Header="Use HTTP Proxy" />
                        <TextBox x:Name="ProxyUriBox" Header="Proxy URL" Width="300"
                                 PlaceholderText="http://127.0.0.1:7890" />
                        <ToggleSwitch x:Name="ProxyBypassLocalToggle" Header="Bypass proxy for localhost" IsOn="True" />
                        <TextBlock Text="Proxy changes take effect after app restart. Localhost bypass ensures Ollama works without proxy."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Behavior -->
            <StackPanel x:Name="BehaviorSection" Spacing="12">
                <TextBlock x:Uid="BehaviorHeader" Text="Behavior" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="12">
                        <!-- UI Language -->
                        <ComboBox
                            x:Name="UILanguageCombo"
                            x:Uid="UILanguageCombo"
                            Header="UI Language"
                            Width="250"
                            SelectionChanged="OnUILanguageChanged"
                            HorizontalAlignment="Left">
                            <ComboBoxItem x:Uid="UILangEnglishItem" Content="English" Tag="en-US" />
                            <ComboBoxItem x:Uid="UILangChineseItem" Content="ç®€ä½“ä¸­æ–‡" Tag="zh-CN" />
                            <ComboBoxItem x:Uid="UILangTraditionalChineseItem" Content="ç¹é«”ä¸­æ–‡" Tag="zh-TW" />
                            <ComboBoxItem x:Uid="UILangJapaneseItem" Content="æ—¥æœ¬èªž" Tag="ja-JP" />
                            <ComboBoxItem x:Uid="UILangKoreanItem" Content="í•œêµ­ì–´" Tag="ko-KR" />
                            <ComboBoxItem x:Uid="UILangFrenchItem" Content="FranÃ§ais" Tag="fr-FR" />
                            <ComboBoxItem x:Uid="UILangGermanItem" Content="Deutsch" Tag="de-DE" />
                        </ComboBox>
                        <TextBlock x:Uid="UILanguageDescription"
                                   Text="Select the display language for the application interface. Restart required."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />

                        <ToggleSwitch x:Name="MinimizeToTrayToggle" x:Uid="MinimizeToTrayToggle" Header="Minimize to system tray" />
                        <ToggleSwitch x:Name="ClipboardMonitorToggle" x:Uid="ClipboardMonitorToggle" Header="Monitor clipboard for text" />
                        <ToggleSwitch x:Name="AlwaysOnTopToggle" x:Uid="AlwaysOnTopToggle" Header="Always on top" />
                        <ToggleSwitch x:Name="LaunchAtStartupToggle" x:Uid="LaunchAtStartupToggle" Header="Launch at Windows startup" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Hotkeys -->
            <StackPanel x:Name="HotkeysSection" Spacing="12">
                <TextBlock Text="Hotkeys" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBox x:Name="ShowHotkeyBox" Header="Show Window" Width="200" PlaceholderText="Ctrl+Alt+T" />
                        <TextBox x:Name="TranslateHotkeyBox" Header="Translate Selection" Width="200" PlaceholderText="Ctrl+Alt+D" />
                        <TextBox x:Name="ShowMiniHotkeyBox" Header="Show Mini Window" Width="200" PlaceholderText="Ctrl+Alt+M" />
                        <TextBox x:Name="ShowFixedHotkeyBox" Header="Show Fixed Window" Width="200" PlaceholderText="Ctrl+Alt+F" />
                        <TextBlock Text="Note: Restart app to apply hotkey changes. Toggle hotkeys use the same key with Shift added (e.g., Ctrl+Alt+Shift+M)."
                                   FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- About -->
            <StackPanel x:Name="AboutSection" Spacing="12">
                <TextBlock Text="About" FontSize="18" FontWeight="SemiBold" />

                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Easydict for Windows" FontWeight="SemiBold" />
                        <TextBlock x:Name="VersionText" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <HyperlinkButton Content="GitHub Repository" NavigateUri="https://github.com/xiaocang/easydict_win32" />

                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock Text="Inspired by" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center" />
                            <HyperlinkButton Content="Easydict for macOS" NavigateUri="https://github.com/tisfeng/Easydict" FontSize="12" Padding="0" />
                        </StackPanel>

                        <TextBlock Text="License: GPL-3.0" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- Spacer to make room for floating save button -->
            <Border Height="80" />
        </StackPanel>
    </ScrollViewer>

    <!-- Floating Save Button (fixed at bottom-right) -->
    <Button x:Name="SaveButton"
            Content="Save Settings"
            Click="OnSaveClick"
            Style="{StaticResource AccentButtonStyle}"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,32,32"
            Padding="24,12"
            Visibility="Collapsed">
        <Button.Shadow>
            <ThemeShadow />
        </Button.Shadow>
    </Button>

    <!-- Floating Navigation Sidebar (left side, vertically centered) -->
    <Border x:Name="NavSidebar"
            HorizontalAlignment="Left"
            VerticalAlignment="Center"
            Margin="8,0,0,0"
            CornerRadius="12"
            Padding="6,10"
            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
            Opacity="0.9">
        <Border.Shadow>
            <ThemeShadow />
        </Border.Shadow>
        <StackPanel x:Name="NavIndicators" Spacing="12">
            <!-- Nav dots created programmatically -->
        </StackPanel>
    </Border>

    <!-- Floating Back Button (top-left, collapsed by default) -->
    <Button x:Name="FloatingBackButton"
            Click="OnBackClick"
            HorizontalAlignment="Left"
            VerticalAlignment="Top"
            Margin="8,8,0,0"
            Width="36"
            Height="36"
            Padding="0"
            CornerRadius="18"
            Visibility="Collapsed"
            ToolTipService.ToolTip="Back">
        <FontIcon Glyph="&#xE72B;" FontSize="14" />
        <Button.Shadow>
            <ThemeShadow />
        </Button.Shadow>
    </Button>

    <!-- Back to Top Button (bottom-left, collapsed by default) -->
    <Button x:Name="BackToTopButton"
            Click="OnBackToTopClick"
            HorizontalAlignment="Left"
            VerticalAlignment="Bottom"
            Margin="8,0,0,32"
            Width="32"
            Height="32"
            Padding="0"
            CornerRadius="16"
            Visibility="Collapsed"
            ToolTipService.ToolTip="Back to top">
        <FontIcon Glyph="&#xE70E;" FontSize="14" />
        <Button.Shadow>
            <ThemeShadow />
        </Button.Shadow>
    </Button>
</Grid>
</Page>

